#!/usr/bin/env bash
set -euo pipefail

# AstroNvim setup - clones the template if nvim config doesn't exist
# This runs once per machine to bootstrap AstroNvim

NVIM_CONFIG="${HOME}/.config/nvim"

# Only set up if nvim config doesn't already have AstroNvim
if [ ! -f "${NVIM_CONFIG}/lua/lazy_setup.lua" ]; then
  echo "Setting up AstroNvim..."
  
  # Backup existing config if present
  if [ -d "${NVIM_CONFIG}" ]; then
    echo "Backing up existing nvim config..."
    mv "${NVIM_CONFIG}" "${NVIM_CONFIG}.bak.$(date +%Y%m%d%H%M%S)"
  fi
  
  # Clean nvim data directories for fresh install
  for dir in "${HOME}/.local/share/nvim" "${HOME}/.local/state/nvim" "${HOME}/.cache/nvim"; do
    if [ -d "$dir" ]; then
      mv "$dir" "${dir}.bak.$(date +%Y%m%d%H%M%S)"
    fi
  done
  
  # Clone AstroNvim template
  git clone --depth 1 https://github.com/AstroNvim/template "${NVIM_CONFIG}"
  
  # Remove template's git so user can init their own
  rm -rf "${NVIM_CONFIG}/.git"
  
  echo "AstroNvim template installed. Run 'nvim' to complete plugin installation."
else
  echo "AstroNvim already configured, skipping setup."
fi
